"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var body=document.querySelector("body");function createLayout(){var e=document.createElement("main");e.classList.add("section","section-100vh"),body.append(e),e.append(createGameSection()),e.append(createMenuSection())}function createGameSection(){var e=document.createElement("section"),t=(e.classList.add("section","game"),document.createElement("div"));return t.classList.add("container","game__container"),e.append(t),t.append(createPlayingField()),t.append(createResultPony()),e}function createPlayingField(){for(var e=document.createElement("div"),t=(e.classList.add("playing-field"),document.createElement("div")),n=(t.classList.add("playing-field__setups"),e.append(t),t.append(createSetups()),document.createElement("div")),a=(n.classList.add("playing-field__container"),e.append(n),Math.pow(4,2)),r=Math.floor(25),s=0;s<a;s++){var o=createCell(s+1,r);n.append(o)}t=n.querySelectorAll(".number-button"),t[t.length-1].style.opacity="0",t[t.length-1].classList.add("dropzone"),t=(gameNumbers=Array.from(n.querySelectorAll(".number-button"))).length;emptyItemValue=t;t=getMatrixValues(gameNumbers.map(function(e){return Number(e.innerHTML)}),4),prevCoords=null,n.style.pointerEvents="none",setPositions(t),t=document.createElement("div");return t.classList.add("playing-field__new-game"),t.append(createNewGameButton()),e.append(t),e}function createSetups(){var e=document.createElement("div"),t=(e.classList.add("setup"),document.createElement("div")),n=(t.classList.add("setup__stats"),e.append(t),document.createElement("div")),a=(n.classList.add("setup__settings"),e.append(n),document.createElement("div")),a=(a.classList.add("setup__timer"),a.innerHTML='Time: <span class="setup__timer-value">0 : 0</span>',t.append(a),document.createElement("div"));return a.classList.add("setup__steps"),a.innerHTML='Steps: <span class="setup__steps-value">0</span>',t.append(a),n.append(createMusicIcon()),n.append(createSettingsIcon()),e}function createMusicIcon(){var e=document.createElement("div");return e.classList.add("music__icon"),e.innerHTML='<svg class="music">\n                      <use xlink:href="./images/sprite.svg#music"></use>\n                    </svg>',e}function createSettingsIcon(){var e=document.createElement("div");return e.classList.add("param__icon"),e.innerHTML='<svg class="param">\n                          <use xlink:href="./images/sprite.svg#setup"></use>\n                        </svg>',e}function createResultPony(){var e=document.createElement("div");return e.classList.add("result-pony"),e.append(createResultPonyText()),e.append(createResultPonyImage()),e}function createNewGameButton(){var e=document.createElement("button");return e.classList.add("button-mix"),e.innerText="new game",e}function createResultPonyText(){var e=document.createElement("div");return e.classList.add("result-pony__text"),e}function createResultPonyImage(){var e=document.createElement("div");return e.classList.add("result-pony__img"),e.innerHTML='<img class="result-pony__pic" src="./images/pony.png" alt="pony">',e}function createMenuSection(){var e=document.createElement("section"),t=(e.classList.add("section","menu"),document.createElement("div"));return t.classList.add("container","menu__container"),e.append(t),t.append(createSaveLoad()),t.append(createPickSize()),t.append(createTopResults()),t.append(createCloseMenu()),e}function createSaveLoad(){var e=document.createElement("div"),t=(e.classList.add("menu__save"),document.createElement("button")),t=(t.classList.add("save"),t.innerText="save",e.append(t),document.createElement("div")),t=(t.classList.add("saved"),t.innerText="saved",e.append(t),document.createElement("button"));return t.classList.add("load"),t.innerText="load",e.append(t),e}function createPickSize(){var e=document.createElement("div"),t=(e.classList.add("menu__pick-size"),document.createElement("div"));t.classList.add("new-size"),e.append(t);for(var n=3;n<9;n++){var a=document.createElement("button");a.classList.add("new-size__btn"),a.innerHTML="".concat(n,"x").concat(n),a.setAttribute("data-size","".concat(n)),t.append(a)}return e}function createTopResults(){var e=document.createElement("div"),t=(e.classList.add("menu__top"),document.createElement("div")),n=(t.classList.add("top-results"),e.append(t),document.createElement("div")),n=(n.classList.add("top-results__title"),n.innerText="Top 10",t.append(n),document.createElement("ul")),t=(n.classList.add("top-results__list"),t.append(n),document.createElement("li"));return t.classList.add("top-results__item"),t.innerHTML='<div class="top-results__time-now">Date</div>\n                         <div class="top-results__steps">Steps</div>\n                         <div class="top-results__time">Time</div>',n.append(t),e}function createCloseMenu(){var e=document.createElement("div"),t=(e.classList.add("menu__close"),document.createElement("button"));return t.classList.add("close-btn"),t.innerHTML='<svg class="close">\n                          <use xlink:href="./images/sprite.svg#close"></use>\n                        </svg>',e.append(t),e}createLayout();var gameField=document.querySelector(".playing-field__container"),sizeButtons=document.querySelectorAll(".new-size__btn"),createCellsList=(sizeButtons.forEach(function(e){var t=Number(e.dataset.size);e.addEventListener("click",function(){return createCellsList(t)})}),function(e){gameField.innerHTML="";for(var t=Math.pow(e,2),n=Math.floor(100/e),a=0;a<t;a++){var r=createCell(a+1,n);gameField.append(r)}e=gameField.querySelectorAll(".number-button");e[e.length-1].style.opacity="0",e[e.length-1].classList.add("dropzone"),gameNumbers=Array.from(gameField.querySelectorAll(".number-button")),numbersCounter=gameNumbers.length,emptyItemValue=numbersCounter,numbersValues=gameNumbers.map(function(e){return Number(e.innerHTML)}),matrixSize=getMatrixSize(numbersCounter),matrixValues=getMatrixValues(numbersValues,matrixSize),prevCoords=null,gameField.style.pointerEvents="none",closeMenu(),clearInterval(timer),timeObj.value=0,timeText.innerHTML="".concat(0," : ",0),stepsCounter=0,stepText.innerHTML="".concat(stepsCounter),setPositions(matrixValues),dropzone=gameNumbers[gameNumbers.length-1],gameField.addEventListener("dragstart",function(e){return dragItem(e)}),dropzone.addEventListener("dragover",function(e){return dragOver(e)}),dropzone.addEventListener("drop",function(e){return dropItem(e)})});function createCell(e,t){var n=document.createElement("button");return n.classList.add("number-button"),n.setAttribute("draggable","true"),n.innerHTML="".concat(e),n.style.width="".concat(t,"%"),n.style.height="".concat(t,"%"),n}var gameNumbers=Array.from(gameField.querySelectorAll(".number-button")),numbersCounter=gameNumbers.length,emptyItemValue=numbersCounter,numbersValues=gameNumbers.map(function(e){return Number(e.innerHTML)}),getMatrixSize=function(e){return Math.sqrt(e)};function getMatrixValues(e,t){for(var n=new Array(t),a=0;a<n.length;a++){var r=new Array(t);n[a]=r}for(var s=0,o=0,i=0;i<e.length;i++)t<=s&&(o++,s=0),n[o][s]=e[i],s++;return n}var matrixSize=getMatrixSize(numbersCounter),matrixValues=getMatrixValues(numbersValues,matrixSize);function setItemPosition(e,t,n){e.style.transform="translate(".concat(100*t,"%, ").concat(100*n,"%)")}function setPositions(e){for(var t=0;t<e.length;t++)for(var n=0;n<e.length;n++){var a=e[t][n];setItemPosition(gameNumbers[a-1],n,t)}}setPositions(matrixValues),gameNumbers[numbersCounter-1].style.opacity="0",gameNumbers[numbersCounter-1].classList.add("dropzone");var prevCoords,timer,mixBtn=document.querySelector(".button-mix"),mixItems=(mixBtn.addEventListener("click",function(){return mixItems()}),function(){for(var e=50*getMatrixSize(numbersCounter),t=0;t<e;t++)swapRandomValidCell(matrixValues);gameField.style.pointerEvents="auto",setPositions(matrixValues),clearInterval(timer),timeObj.value=0,stepsCounter=0,timeText.innerHTML="0 : 0",stepText.innerHTML="0",stopwatch()}),swapRandomValidCell=function(e){var t=pickValidItems(prevCoords),t=t[Math.floor(Math.random()*t.length)],t=findCoodsByItem(t,e),n=findCoodsByItem(emptyItemValue,e);swapItems(t,n,e),prevCoords=n},moveItem=(gameField.addEventListener("click",function(e){return moveItem(e)}),function(e){var t,e=e.target.closest(".number-button");e&&(e=Number(e.innerHTML),e=findCoodsByItem(e,matrixValues),t=findCoodsByItem(emptyItemValue,matrixValues),swapValidation(e,t)?(stepsCounter++,swapItems(e,t,matrixValues),stepText.innerHTML="".concat(stepsCounter),audio.play()):flashValid())}),flashValid=function(){pickValidItems().forEach(function(e){gameNumbers[e-1].classList.add("number-button--green"),setTimeout(function(){return gameNumbers[e-1].classList.remove("number-button--green")},2500)})},findCoodsByItem=function(e,t){for(var n=0;n<t.length;n++)for(var a=0;a<t.length;a++)if(t[n][a]==e)return{x:a,y:n}},swapValidation=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:findCoodsByItem(emptyItemValue,matrixValues),n=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y);return!(1!=n&&1!=a||t.x!=e.x&&t.y!=e.y)},swapItems=function(e,t,n){var a=n[e.y][e.x];n[e.y][e.x]=n[t.y][t.x],n[t.y][t.x]=a,setPositions(n),isWin(n)&&(flashWin(),validateTopResult(stepsCounter,timeObj),showResult(),gameField.style.pointerEvents="none",clearInterval(timer))},getWinCombination=function(){return new Array(matrixValues.flat().length).fill(0).map(function(e,t){return t+1})},isWin=function(e){for(var t=getWinCombination(),n=e.flat(),a=0;a<t.length;a++)if(t[a]!==n[a])return!1;return!0},flashWin=function(){var e=gameField.querySelectorAll(".number-button");setTimeout(function(){return e.forEach(function(e){return e.classList.add("number-button--green")})},200),setTimeout(function(){return e.forEach(function(e){return e.classList.remove("number-button--green")})},2e3)},pickValidItems=function(e){var t=findCoodsByItem(emptyItemValue,matrixValues),n=[];return e?(matrixValues[t.y+1]&&matrixValues[t.y+1][t.x]!=matrixValues[e.y][e.x]&&n.push(matrixValues[t.y+1][t.x]),matrixValues[t.y-1]&&matrixValues[t.y-1][t.x]!=matrixValues[e.y][e.x]&&n.push(matrixValues[t.y-1][t.x]),matrixValues[t.x+1]&&matrixValues[t.y][t.x+1]!=matrixValues[e.y][e.x]&&n.push(matrixValues[t.y][t.x+1]),matrixValues[t.x-1]&&matrixValues[t.y][t.x-1]!=matrixValues[e.y][e.x]&&n.push(matrixValues[t.y][t.x-1])):(matrixValues[t.y+1]&&n.push(matrixValues[t.y+1][t.x]),matrixValues[t.y-1]&&n.push(matrixValues[t.y-1][t.x]),matrixValues[t.x+1]&&n.push(matrixValues[t.y][t.x+1]),matrixValues[t.x-1]&&n.push(matrixValues[t.y][t.x-1])),n},resultFlag=1,showResult=function(){var e=document.querySelector(".result-pony"),t=e.querySelector(".result-pony__text"),n=1e3*resultFlag;t.innerHTML="Hooray! You solved the puzzle<br>in ".concat(timeObj.min," : ").concat(timeObj.sec," and ").concat(stepsCounter," moves"),e.style.transform="translateX(".concat(0,")"),setTimeout(function(){e.style.transform="translateX(".concat(n,"%)"),timeObj.value=0,stepsCounter=0,timeText.innerHTML="0 : 0",stepText.innerHTML="0"},5e3),resultFlag*=-1},timeObj={value:0,sec:0,min:0},stepsCounter=0,stopwatch=function(){timer=setInterval(function(){timeObj.sec=timeObj.value%60,timeObj.min=Math.trunc(timeObj.value/60%60),timeText.innerHTML="".concat(timeObj.min," : ").concat(timeObj.sec),timeObj.value++},1e3)},timeText=document.querySelector(".setup__timer-value"),stepText=document.querySelector(".setup__steps-value"),audio=new Audio,muteSound=(audio.src="./images/mixkit-plastic-bubble-click-1124.wav",document.querySelector(".music")),closeBtn=(muteSound.addEventListener("click",function(){muteSound.classList.contains("music--mute")?(muteSound.classList.remove("music--mute"),audio.volume=1):(muteSound.classList.add("music--mute"),audio.volume=0)}),document.querySelector(".close-btn")),overlay=document.querySelector(".menu"),openButton=document.querySelector(".param__icon"),closeMenu=(closeBtn.addEventListener("click",function(){return closeMenu()}),function(){overlay.style.transform="translateY(".concat(-100,"%)"),0<timeObj.value&&stopwatch()}),openMenu=(openButton.addEventListener("click",function(){return openMenu()}),function(){overlay.style.transform="translateY(".concat(0,"%)"),clearInterval(timer)}),topList=document.querySelector(".top-results__list"),addNewTopNote=function(e,t){var n=new Date,a=document.createElement("div"),r=(a.classList.add("top-results__item"),document.createElement("div")),n=(r.classList.add("top-results__time-now"),r.innerText="".concat(n.getHours(),":").concat(n.getMinutes()," ").concat(n.getDate(),".").concat(n.getMonth()+1),document.createElement("div")),e=(n.classList.add("top-results__steps"),n.innerText="".concat(e),document.createElement("div"));return e.classList.add("top-results__time"),e.innerText="".concat(t.min," : ").concat(t.sec),a.append(r,n,e),a},sortResults=function(){var e=_toConsumableArray(document.querySelectorAll(".top-results__item"));e.shift(),e.sort(function(e,t){return Number(e.querySelector(".top-results__steps").innerHTML)>Number(t.querySelector(".top-results__steps").innerHTML)?1:Number(e.querySelector(".top-results__steps").innerHTML)<Number(t.querySelector(".top-results__steps").innerHTML)?-1:0}),topList.innerHTML='<li class="top-results__item">\n  <div class="top-results__time-now">Date</div>\n  <div class="top-results__steps">Steps</div>\n  <div class="top-results__time">Time</div>\n  </li>',e.forEach(function(e){return topList.append(e)})},saveTopResult=function(){var e;localStorage.getItem("topResults")&&localStorage.removeItem("topResults"),e=topList.innerHTML,localStorage.setItem("topResults",e)},loadTopResults=function(){var e=localStorage.getItem("topResults");e&&(topList.innerHTML="".concat(e))},validateTopResult=(loadTopResults(),function(e,t){var n=_toConsumableArray(document.querySelectorAll(".top-results__steps"));n.shift(),(n=n.map(function(e){return Number(e.innerHTML)})).length<10?(topList.append(addNewTopNote(e,t)),sortResults()):(topList.append(addNewTopNote(e,t)),sortResults(),(n=document.querySelectorAll(".top-results__item"))[n.length-1].remove()),saveTopResult()}),saveBtn=document.querySelector(".save"),saved=document.querySelector(".saved"),load=document.querySelector(".load"),saveResult=(saveBtn.addEventListener("click",function(){return saveResult()}),function(){saved.style.opacity="1",setTimeout(function(){return saved.style.opacity="0"},2e3);var e={matrixSize:matrixSize,matrixValues:matrixValues,timeObj:timeObj,stepsCounter:stepsCounter};localStorage.setItem("game",JSON.stringify(e))}),loadGame=(load.addEventListener("click",function(){return loadGame()}),function(){var e=localStorage.getItem("game"),t=JSON.parse(e);e&&(createCellsList(t.matrixSize),setPositions(t.matrixValues),matrixValues=t.matrixValues,stepText.innerHTML="".concat(t.stepsCounter),stepsCounter=t.stepsCounter,timeText.innerHTML="".concat(t.timeObj.min," : ").concat(t.timeObj.sec),clearInterval(timer),timeObj.value=t.timeObj.value,stopwatch(),gameField.style.pointerEvents="auto",overlay.style.transform="translateY(".concat(-100,"%)"))}),dropzone=gameNumbers[gameNumbers.length-1],dragItem=(gameField.addEventListener("dragstart",function(e){return dragItem(e)}),dropzone.addEventListener("dragover",function(e){return dragOver(e)}),dropzone.addEventListener("drop",function(e){return dropItem(e)}),function(e){var t=e.target.innerHTML;e.dataTransfer.setData("value",t)}),dragOver=function(e){e.preventDefault()},dropItem=function(e){var e=e.dataTransfer.getData("value"),e=Number(e),e=findCoodsByItem(e,matrixValues),t=findCoodsByItem(emptyItemValue,matrixValues);swapValidation(e,t)?(stepsCounter++,swapItems(e,t,matrixValues),stepText.innerHTML="".concat(stepsCounter),audio.play()):flashValid()};